
ä»“åº“åœ°å€ï¼š https://github.com/peter941221/SecretHawk
**è®¸å¯è¯ **Apache 2.0**ï¼ˆæœ‰ä¸“åˆ©ä¿æŠ¤ï¼‰ã€‚

---

å®Œæ•´æŠ€æœ¯æ–‡æ¡£ï¼ˆPRDï¼‰

ä¸‹é¢æ˜¯**ä»ä½ åŸå§‹æ–‡æ¡£æ”¹è¿›åçš„å®Œæ•´ç‰ˆ**ï¼Œè¡¥å……äº†ä½ ç¼ºçš„éƒ¨åˆ†ï¼šæ¶æ„è®¾è®¡ã€å‘½ä»¤è§„æ ¼ã€æ•°æ®æ¨¡å‹ã€è¾“å‡ºæ ¼å¼ schemaã€è¿æ¥å™¨æ¥å£ã€ç­–ç•¥æ–‡ä»¶æ ¼å¼ã€éªŒæ”¶æ ‡å‡†ã€‚

---

# SecretHawk äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰

## ç‰ˆæœ¬ï¼šv0.1 | çŠ¶æ€ï¼šDraft

---

## 0. æ–‡æ¡£å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| 0.1 | 2026-02 | åˆå§‹ç‰ˆæœ¬ |

---

## 1. äº§å“å®šä½

### 1.1 ä¸€å¥è¯å®šä½

> **Secret scanning is solved. Secret remediation isn't.**

### 1.2 æˆ‘ä»¬è§£å†³ä»€ä¹ˆé—®é¢˜

å¼€å‘è€…ä¸å°å¿ƒæŠŠå¯†é’¥æäº¤åˆ°ä»£ç ä»“åº“åï¼Œ**ä»å‘ç°åˆ°å®Œå…¨ä¿®å¤**çš„è¿‡ç¨‹æå…¶ç—›è‹¦ï¼š

```
ç°çŠ¶ï¼ˆæ²¡æœ‰æˆ‘ä»¬çš„å·¥å…·ï¼‰ï¼š

å¼€å‘è€…æäº¤å¯†é’¥ â†’ æ‰«æå™¨å‘Šè­¦ â†’ å¼€å‘è€…çœ‹åˆ°å‘Šè­¦ â†’ ???
                                                    â†“
                                          ä¸çŸ¥é“æ€ä¹ˆæ’¤é”€
                                          ä¸çŸ¥é“ä»£ç æ€ä¹ˆæ”¹
                                          ä¸çŸ¥é“ CI é‡Œè¿˜æœ‰æ²¡æœ‰
                                          ä¸çŸ¥é“ Git å†å²æ€ä¹ˆæ¸…
                                          ä¸çŸ¥é“è¦ä¸è¦é€šçŸ¥è°
                                                    â†“
                                              ç»“æœï¼šä¸å¤„ç†
                                                    â†“
                                           70% å¯†é’¥ä¸¤å¹´åä»æœ‰æ•ˆ
```

```
ç›®æ ‡ï¼ˆæœ‰æˆ‘ä»¬çš„å·¥å…·ï¼‰ï¼š

å¼€å‘è€…æäº¤å¯†é’¥ â†’ secrethawk æ£€æµ‹ â†’ äº¤äº’å¼ä¿®å¤å‘å¯¼ â†’ 5åˆ†é’Ÿå†…å®Œæˆï¼š
                                                      âœ… å¯†é’¥å·²æ’¤é”€
                                                      âœ… ä»£ç å·²æ›¿æ¢ä¸ºç¯å¢ƒå˜é‡
                                                      âœ… CI secrets å·²åŒæ­¥
                                                      âœ… Git å†å²å·²æ¸…ç†
                                                      âœ… äº‹æ•…æŠ¥å‘Šå·²ç”Ÿæˆ
```

### 1.3 ç›®æ ‡ç”¨æˆ·

| ä¼˜å…ˆçº§ | ç”¨æˆ·è§’è‰² | åœºæ™¯ | ä»˜è´¹æ„æ„¿ |
|--------|----------|------|----------|
| P0 | ç‹¬ç«‹å¼€å‘è€… / å°å›¢é˜Ÿ lead | è‡ªå·±æˆ–å›¢é˜Ÿæˆå‘˜è¯¯æäº¤å¯†é’¥ï¼Œéœ€è¦å¿«é€Ÿä¿®å¤ | å…è´¹ç‰ˆå³å¯ï¼Œä½†ä¼šä¼ æ’­ |
| P1 | DevOps / Platform Engineer | åœ¨ CI/CD ä¸­é›†æˆå¯†é’¥æ‰«æ+ä¿®å¤æµç¨‹ | æ„¿æ„ä¸ºè‡ªåŠ¨åŒ–ä»˜è´¹ |
| P2 | å®‰å…¨å·¥ç¨‹å¸ˆ / AppSec | éœ€è¦ç»„ç»‡çº§åˆ«çš„å¯†é’¥æ³„éœ²ç®¡ç†ã€å®¡è®¡ã€SLA | æ„¿æ„ä»˜è¾ƒé«˜ä»·æ ¼ |

### 1.4 ä¸åšä»€ä¹ˆï¼ˆæ˜ç¡®è¾¹ç•Œï¼‰

```
âŒ ä¸åšé€šç”¨ SAST / DASTï¼ˆä»£ç æ¼æ´æ‰«æä¸æ˜¯æˆ‘ä»¬çš„äº‹ï¼‰
âŒ ä¸åšå¯†é’¥ç®¡ç†å¹³å°ï¼ˆVault / AWS Secrets Manager çš„æ´»ï¼‰
âŒ ä¸åšåˆè§„è®¤è¯å’¨è¯¢
âŒ MVP é˜¶æ®µä¸åš Web Dashboard
```

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·è§¦å‘æ–¹å¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CLI æ‰‹åŠ¨  â”‚  â”‚pre-commitâ”‚  â”‚GitHub    â”‚  â”‚ CI Pipeline â”‚ â”‚
â”‚  â”‚ æ‰§è¡Œ     â”‚  â”‚ hook     â”‚  â”‚Action    â”‚  â”‚ (é€šç”¨)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚             â”‚               â”‚
        â–¼              â–¼             â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SecretHawk CLI æ ¸å¿ƒ                      â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Scanner    â”‚  â”‚  Validator   â”‚  â”‚  Remediator       â”‚  â”‚
â”‚  â”‚  Engine     â”‚  â”‚  Engine      â”‚  â”‚  Engine           â”‚  â”‚
â”‚  â”‚             â”‚  â”‚              â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚ - Regex     â”‚  â”‚ - API è°ƒç”¨   â”‚  â”‚ - æ’¤é”€/è½®è½¬       â”‚  â”‚
â”‚  â”‚ - Entropy   â”‚  â”‚   éªŒè¯å¯†é’¥   â”‚  â”‚ - ä»£ç æ›¿æ¢        â”‚  â”‚
â”‚  â”‚ - AST(å¯é€‰) â”‚  â”‚   æ˜¯å¦æœ‰æ•ˆ   â”‚  â”‚ - Git å†å²æ¸…ç†    â”‚  â”‚
â”‚  â”‚             â”‚  â”‚              â”‚  â”‚ - CI åŒæ­¥         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                â”‚                    â”‚             â”‚
â”‚         â–¼                â–¼                    â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Rules & Policy Engine                  â”‚    â”‚
â”‚  â”‚  - å†…ç½®è§„åˆ™ï¼ˆrules/*.yamlï¼‰                          â”‚    â”‚
â”‚  â”‚  - ç”¨æˆ·è‡ªå®šä¹‰ç­–ç•¥ï¼ˆ.secrethawk/policy.yamlï¼‰          â”‚    â”‚
â”‚  â”‚  - Allowlist / Baseline                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Connector Interfaceï¼ˆæ’ä»¶ï¼‰              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ AWS â”‚ â”‚GitHubâ”‚ â”‚Stripe â”‚ â”‚Slack â”‚ â”‚ Generic  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Output Formatter                       â”‚    â”‚
â”‚  â”‚  - Humanï¼ˆå½©è‰²ç»ˆç«¯ï¼‰                                  â”‚    â”‚
â”‚  â”‚  - JSON                                             â”‚    â”‚
â”‚  â”‚  - SARIFï¼ˆGitHub Code Scanning å…¼å®¹ï¼‰                 â”‚    â”‚
â”‚  â”‚  - Markdownï¼ˆäº‹æ•…æŠ¥å‘Šï¼‰                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ (å›¢é˜Ÿç‰ˆï¼Œv2+)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SecretHawk Cloudï¼ˆç§æœ‰ï¼‰                    â”‚
â”‚  - äº‹ä»¶èšåˆ & Dashboard                                      â”‚
â”‚  - å›¢é˜Ÿç®¡ç† / RBAC                                           â”‚
â”‚  - SLA è¿½è¸ª & å‡çº§å‘Šè­¦                                       â”‚
â”‚  - å®¡è®¡æ—¥å¿— & åˆè§„å¯¼å‡º                                        â”‚
â”‚  - Webhook / Slack / PagerDuty é›†æˆ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯é€‰å‹

| ç»„ä»¶ | é€‰æ‹© | ç†ç”± |
|------|------|------|
| å¼€å‘è¯­è¨€ | **Go** | å•äºŒè¿›åˆ¶åˆ†å‘ã€äº¤å‰ç¼–è¯‘ã€Gitleaks/TruffleHog éƒ½ç”¨ Goï¼ˆç”Ÿæ€ç†Ÿæ‚‰ï¼‰ã€æ€§èƒ½å¥½ |
| è§„åˆ™æ ¼å¼ | YAML | äººç±»å¯è¯»ã€ä¸ Gitleaks è§„åˆ™æ ¼å¼å…¼å®¹ï¼ˆé™ä½è¿ç§»æˆæœ¬ï¼‰ |
| è¾“å‡ºæ ¼å¼ | JSON + SARIF + Human | JSON ç»™ç¨‹åºç”¨ã€SARIF ç»™ GitHub Code Scanningã€Human ç»™ç»ˆç«¯ |
| Git æ“ä½œ | go-git æˆ–è°ƒç”¨ git CLI | go-git çº¯ Go å®ç°ï¼Œä½†æŸäº›æ“ä½œï¼ˆfilter-branchï¼‰ä»éœ€ git CLI |
| TUI äº¤äº’ | charmbracelet/bubbletea | Go ç”Ÿæ€æœ€å¥½çš„ TUI æ¡†æ¶ï¼Œè§†è§‰æ•ˆæœå¥½ |
| å®‰è£…åˆ†å‘ | goreleaser | è‡ªåŠ¨æ„å»º brew/scoop/apt/docker/GitHub Release |

---

## 3. å‘½ä»¤è®¾è®¡ï¼ˆè¯¦ç»†è§„æ ¼ï¼‰

### 3.1 å‘½ä»¤æ€»è§ˆ

```bash
secrethawk
â”œâ”€â”€ scan          # æ‰«æå¯†é’¥æ³„éœ²
â”œâ”€â”€ validate      # éªŒè¯å‘ç°çš„å¯†é’¥æ˜¯å¦ä»ç„¶æœ‰æ•ˆ
â”œâ”€â”€ remediate     # äº¤äº’å¼ä¿®å¤å‘å¯¼
â”œâ”€â”€ patch         # ç”Ÿæˆä»£ç æ›¿æ¢è¡¥ä¸
â”œâ”€â”€ history-clean # æ¸…ç† Git å†å²ä¸­çš„å¯†é’¥
â”œâ”€â”€ report        # ç”Ÿæˆäº‹æ•…æŠ¥å‘Š
â”œâ”€â”€ policy        # ç®¡ç†æ‰«æç­–ç•¥
â”‚   â”œâ”€â”€ init      # åˆå§‹åŒ–ç­–ç•¥æ–‡ä»¶
â”‚   â”œâ”€â”€ check     # æ£€æŸ¥ç­–ç•¥æ–‡ä»¶æ˜¯å¦åˆæ³•
â”‚   â””â”€â”€ test      # ç”¨æµ‹è¯•ç”¨ä¾‹éªŒè¯ç­–ç•¥
â”œâ”€â”€ connector     # ç®¡ç†è¿æ¥å™¨
â”‚   â”œâ”€â”€ list      # åˆ—å‡ºå¯ç”¨è¿æ¥å™¨
â”‚   â”œâ”€â”€ test      # æµ‹è¯•è¿æ¥å™¨é…ç½®
â”‚   â””â”€â”€ rotate    # é€šè¿‡è¿æ¥å™¨æ‰§è¡Œå¯†é’¥è½®è½¬
â”œâ”€â”€ baseline      # ç®¡ç†å·²çŸ¥/å·²å¤„ç†çš„ findings
â”‚   â”œâ”€â”€ create    # åˆ›å»º baseline æ–‡ä»¶
â”‚   â””â”€â”€ update    # æ›´æ–° baseline
â””â”€â”€ version       # ç‰ˆæœ¬ä¿¡æ¯
```

### 3.2 `scan` å‘½ä»¤è¯¦ç»†è§„æ ¼

```bash
secrethawk scan [ç›®æ ‡] [é€‰é¡¹]
```

**å‚æ•°ï¼š**

| å‚æ•°/Flag | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----------|------|--------|------|
| `[ç›®æ ‡]` | string | `.`ï¼ˆå½“å‰ç›®å½•ï¼‰ | æ‰«æè·¯å¾„ï¼Œæ”¯æŒæ–‡ä»¶/ç›®å½•/git ä»“åº“ |
| `--staged` | bool | false | åªæ‰«æ git staged çš„æ–‡ä»¶ |
| `--since <ref>` | string | - | æ‰«æä»æŒ‡å®š commit/branch ä¹‹åçš„å˜æ›´ |
| `--all-history` | bool | false | æ‰«æå®Œæ•´ git å†å² |
| `--rules <path>` | string | å†…ç½®è§„åˆ™ | è‡ªå®šä¹‰è§„åˆ™æ–‡ä»¶è·¯å¾„ |
| `--policy <path>` | string | `.secrethawk/policy.yaml` | ç­–ç•¥æ–‡ä»¶è·¯å¾„ |
| `--baseline <path>` | string | `.secrethawk/baseline.json` | baseline æ–‡ä»¶è·¯å¾„ |
| `--format` | enum | `human` | è¾“å‡ºæ ¼å¼ï¼š`human` / `json` / `sarif` |
| `--output <path>` | string | stdout | è¾“å‡ºåˆ°æ–‡ä»¶ |
| `--severity <level>` | enum | `low` | æœ€ä½æŠ¥å‘Šçº§åˆ«ï¼š`low`/`medium`/`high`/`critical` |
| `--validate` | bool | false | å¯¹å‘ç°çš„å¯†é’¥è‡ªåŠ¨éªŒè¯æ˜¯å¦æœ‰æ•ˆ |
| `--fail-on <level>` | enum | - | å½“å‘ç° >= è¯¥çº§åˆ«çš„å¯†é’¥æ—¶è¿”å›éé›¶é€€å‡ºç ï¼ˆç”¨äº CIï¼‰ |
| `--max-target-megabytes` | int | 50 | è·³è¿‡è¶…è¿‡æ­¤å¤§å°çš„æ–‡ä»¶ |
| `--threads` | int | CPU æ ¸æ•° | å¹¶è¡Œæ‰«æçº¿ç¨‹æ•° |
| `--verbose` | bool | false | è¯¦ç»†è¾“å‡º |

**é€€å‡ºç ï¼š**

| é€€å‡ºç  | å«ä¹‰ |
|--------|------|
| 0 | æ— å‘ç° / å‘ç°å‡ä½äº `--fail-on` é˜ˆå€¼ |
| 1 | å‘ç°å¯†é’¥ä¸”è¾¾åˆ° `--fail-on` é˜ˆå€¼ |
| 2 | è¿è¡Œæ—¶é”™è¯¯ï¼ˆé…ç½®é”™è¯¯ã€æƒé™ä¸è¶³ç­‰ï¼‰ |

**ç»ˆç«¯è¾“å‡ºç¤ºä¾‹ï¼ˆhuman æ ¼å¼ï¼‰ï¼š**

```
$ secrethawk scan --staged --validate

  SecretHawk v0.1.0 â€” Secret Remediation CLI
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Scanning 3 staged files...

  ğŸ”´ CRITICAL  AWS Access Key ID
     File:     src/config.py:12
     Match:    AKIA3EXAMPLE7JKXQ4F7
     Commit:   (staged, not yet committed)
     Status:   âœ… ACTIVE (validated via AWS STS)
     Action:   Run `secrethawk remediate` to fix

  ğŸŸ¡ MEDIUM    Generic High-Entropy String
     File:     .env.example:5
     Match:    a]8kF#2...ï¼ˆæˆªæ–­ï¼‰
     Commit:   (staged, not yet committed)
     Status:   âšª NOT VALIDATED (no connector available)
     Action:   Review manually or add to baseline

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Summary: 2 findings (1 critical, 1 medium)
  Run `secrethawk remediate --interactive` to start fixing.
```

**éªŒæ”¶æ ‡å‡†ï¼ˆscanï¼‰ï¼š**

```
AC-SCAN-001: ç»™å®šä¸€ä¸ªåŒ…å« AWS Key çš„æ–‡ä»¶ï¼Œæ‰§è¡Œ scanï¼Œ
             å¿…é¡»è¾“å‡ºè¯¥ findingï¼ŒåŒ…å«æ–‡ä»¶ï¿½ï¿½å¾„ã€è¡Œå·ã€åŒ¹é…å†…å®¹ã€ä¸¥é‡çº§åˆ«ã€‚

AC-SCAN-002: ç»™å®š --staged flagï¼Œåªæ‰«æ git staged æ–‡ä»¶ï¼Œ
             æœª staged çš„æ–‡ä»¶ä¸­çš„å¯†é’¥ä¸åº”è¢«æŠ¥å‘Šã€‚

AC-SCAN-003: ç»™å®š --since origin/mainï¼Œåªæ‰«æè¯¥ ref ä¹‹åçš„ diffï¼Œ
             main åˆ†æ”¯å·²æœ‰çš„å¯†é’¥ä¸åº”è¢«æŠ¥å‘Šã€‚

AC-SCAN-004: ç»™å®š --validate flag å’Œä¸€ä¸ªæœ‰æ•ˆçš„ AWS Keyï¼Œ
             è¾“å‡ºä¸­ Status å­—æ®µå¿…é¡»æ˜¾ç¤º "ACTIVE"ã€‚

AC-SCAN-005: ç»™å®š --validate flag å’Œä¸€ä¸ªå·²æ’¤é”€çš„ AWS Keyï¼Œ
             è¾“å‡ºä¸­ Status å­—æ®µå¿…é¡»æ˜¾ç¤º "INACTIVE"ã€‚

AC-SCAN-006: ç»™å®š --format jsonï¼Œè¾“å‡ºå¿…é¡»æ˜¯åˆæ³• JSONï¼Œ
             ä¸”ç»“æ„ç¬¦åˆ Â§4.1 å®šä¹‰çš„ Finding Schemaã€‚

AC-SCAN-007: ç»™å®š --format sarifï¼Œè¾“å‡ºå¿…é¡»æ˜¯åˆæ³• SARIF 2.1.0ï¼Œ
             ä¸”å¯è¢« GitHub Code Scanning æ¥å—ã€‚

AC-SCAN-008: ç»™å®š --fail-on highï¼Œå½“å­˜åœ¨ high/critical finding æ—¶ï¼Œ
             é€€å‡ºç å¿…é¡»ä¸º 1ï¼›åªæœ‰ low/medium æ—¶é€€å‡ºç ä¸º 0ã€‚

AC-SCAN-009: ç»™å®š baseline æ–‡ä»¶ä¸­å·²è®°å½•çš„ findingï¼Œ
             æ‰«æç»“æœä¸­è¯¥ finding ä¸åº”å†æ¬¡æŠ¥å‘Šï¼ˆé™¤é --ignore-baselineï¼‰ã€‚

AC-SCAN-010: æ‰«æ 1000 ä¸ªæ–‡ä»¶ï¼ˆå¹³å‡æ¯ä¸ª 50KBï¼‰åº”åœ¨ 10 ç§’å†…å®Œæˆ
             ï¼ˆåŸºå‡†ç¡¬ä»¶ï¼š4 æ ¸ CPUã€8GB RAMï¼‰ã€‚

AC-SCAN-011: ç»™å®š policy ä¸­ allowlist é…ç½®äº†æŸä¸ªè·¯å¾„æ¨¡å¼ï¼Œ
             åŒ¹é…è¯¥è·¯å¾„çš„æ–‡ä»¶ä¸­çš„ findings ä¸åº”è¢«æŠ¥å‘Šã€‚
```

### 3.3 `remediate` å‘½ä»¤è¯¦ç»†è§„æ ¼

```bash
secrethawk remediate [é€‰é¡¹]
```

**å‚æ•°ï¼š**

| å‚æ•°/Flag | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----------|------|--------|------|
| `--interactive` / `-i` | bool | true | äº¤äº’å¼é€æ¡å¤„ç† |
| `--input <path>` | string | - | ä» scan è¾“å‡ºçš„ JSON æ–‡ä»¶è¯»å– findings |
| `--auto` | bool | false | è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰å¯è‡ªåŠ¨åŒ–çš„ä¿®å¤ï¼ˆå±é™©ï¼Œéœ€ç¡®è®¤ï¼‰ |
| `--dry-run` | bool | false | åªæ˜¾ç¤ºä¼šåšä»€ä¹ˆï¼Œä¸å®é™…æ‰§è¡Œ |
| `--connector <name>` | string | auto-detect | æŒ‡å®šä½¿ç”¨çš„è¿æ¥å™¨ |

**äº¤äº’å¼æµç¨‹ï¼ˆæ ¸å¿ƒä½“éªŒï¼‰ï¼š**

```
$ secrethawk remediate --interactive

  SecretHawk Remediation Wizard
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Finding 1/2: AWS Access Key ID
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ File:     src/config.py:12                   â”‚
  â”‚ Type:     AWS Access Key ID                  â”‚
  â”‚ Match:    AKIA3EXAMPLE7JKXQ4F7               â”‚
  â”‚ Status:   âœ… ACTIVE                           â”‚
  â”‚ Risk:     ğŸ”´ CRITICAL                         â”‚
  â”‚                                              â”‚
  â”‚ This key has IAM permissions:                â”‚
  â”‚   - s3:GetObject                             â”‚
  â”‚   - s3:PutObject                             â”‚
  â”‚   - ec2:DescribeInstances                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Available actions:
  [1] ğŸ”„ Rotate key (deactivate old â†’ create new â†’ update references)
  [2] âŒ Revoke only (deactivate, no replacement)
  [3] ğŸ“ Replace in code (hardcoded â†’ env var / secret manager ref)
  [4] ğŸ§¹ Clean from git history (rewrite commits containing this key)
  [5] ğŸ“‹ Generate incident report
  [6] â­ï¸  Skip (add to baseline)
  [7] ğŸš« False positive (add to allowlist)

  Select actions (comma-separated, e.g. 1,3,5) > 1,3,5

  â”€â”€ Executing: Rotate key â”€â”€
  â„¹  Deactivating old key AKIA3EXAMPLE7JKXQ4F7...
  âœ… Old key deactivated
  â„¹  Creating new key for IAM user deploy-bot...
  âœ… New key created: AKIA3NEWKEY...ï¼ˆåç»­ä¸å†æ˜¾ç¤ºå®Œæ•´å€¼ï¼‰
  â„¹  New key stored in: AWS Secrets Manager â†’ prod/deploy-bot-key

  â”€â”€ Executing: Replace in code â”€â”€
  â„¹  Replacing hardcoded value in src/config.py:12
     Before: aws_key = "AKIA3EXAMPLE7JKXQ4F7"
     After:  aws_key = os.environ["AWS_ACCESS_KEY_ID"]
  â„¹  Adding to .env.example: AWS_ACCESS_KEY_ID=<your-key-here>
  âœ… Code patched. Run `git diff` to review.

  â”€â”€ Executing: Generate incident report â”€â”€
  âœ… Report saved to: .secrethawk/reports/2025-01-15-001.md

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Finding 2/2: Generic High-Entropy String
  ...
```

**éªŒæ”¶æ ‡å‡†ï¼ˆremediateï¼‰ï¼š**

```
AC-REM-001: ç»™å®šä¸€ä¸ªåŒ…å«æœ‰æ•ˆ AWS Key çš„ findingï¼Œé€‰æ‹© "Rotate key"ï¼Œ
            æ—§å¯†é’¥å¿…é¡»è¢« deactivateï¼ˆé€šè¿‡ AWS API éªŒè¯ï¼‰ï¼Œ
            æ–°å¯†é’¥å¿…é¡»è¢«åˆ›å»ºå¹¶å­˜å‚¨åˆ°æŒ‡å®šä½ç½®ã€‚

AC-REM-002: ç»™å®šé€‰æ‹© "Replace in code"ï¼Œ
            ä»£ç æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç å¯†é’¥å¿…é¡»è¢«æ›¿æ¢ä¸ºç¯å¢ƒå˜é‡å¼•ç”¨ï¼Œ
            ä¸” .env.example æ–‡ä»¶ä¸­å¿…é¡»æ–°å¢å¯¹åº”å˜é‡åã€‚

AC-REM-003: ç»™å®š --dry-run flagï¼Œæ‰€æœ‰æ“ä½œåªæ˜¾ç¤º"å°†è¦åšä»€ä¹ˆ"ï¼Œ
            ä¸å®é™…ä¿®æ”¹ä»»ä½•æ–‡ä»¶ã€ä¸è°ƒç”¨ä»»ä½•å¤–éƒ¨ APIã€‚

AC-REM-004: ç»™å®šé€‰æ‹© "Skip"ï¼Œè¯¥ finding å¿…é¡»è¢«å†™å…¥ baseline æ–‡ä»¶ï¼Œ
            åç»­ scan ä¸å†æŠ¥å‘Šã€‚

AC-REM-005: ç»™å®šé€‰æ‹© "False positive"ï¼Œè¯¥ finding çš„æ¨¡å¼å¿…é¡»è¢«
            å†™å…¥ policy çš„ allowlist éƒ¨åˆ†ã€‚

AC-REM-006: ç»™å®šé€‰æ‹© "Generate incident report"ï¼Œ
            å¿…é¡»ç”ŸæˆåŒ…å«ä»¥ä¸‹å­—æ®µçš„ Markdown æ–‡ä»¶ï¼š
            å‘ç°æ—¶é—´ã€å¯†é’¥ç±»å‹ã€æ–‡ä»¶ä½ç½®ã€æ“ä½œäººã€å¤„ç†åŠ¨ä½œã€å¤„ç†æ—¶é—´ã€‚

AC-REM-007: å½“è¿æ¥å™¨éœ€è¦çš„å‡­æ®æœªé…ç½®æ—¶ï¼Œ
            å¿…é¡»ç»™å‡ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯å’Œé…ç½®æŒ‡å¼•ï¼Œè€Œä¸æ˜¯å´©æºƒã€‚

AC-REM-008: æ•´ä¸ªäº¤äº’è¿‡ç¨‹ä¸­ï¼Œæ–°å¯†é’¥çš„å®Œæ•´å€¼ä¸åº”è¢«æ‰“å°åˆ°ç»ˆç«¯
            ï¼ˆé˜²æ­¢å±å¹•å½•åˆ¶æ³„éœ²ï¼‰ã€‚
```

### 3.4 `patch` å‘½ä»¤è¯¦ç»†è§„æ ¼

```bash
secrethawk patch [é€‰é¡¹]
```

| å‚æ•°/Flag | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----------|------|--------|------|
| `--replace-with` | enum | `env` | æ›¿æ¢ç­–ç•¥ï¼š`env`ï¼ˆç¯å¢ƒå˜é‡ï¼‰/ `secretmanager`ï¼ˆå¼•ç”¨ Secret Managerï¼‰/ `placeholder`ï¼ˆå ä½ç¬¦ï¼‰ |
| `--var-prefix` | string | `""` | ç¯å¢ƒå˜é‡å‰ç¼€ï¼Œå¦‚ `APP_` |
| `--commit` | bool | false | è‡ªåŠ¨åˆ›å»º git commit |
| `--commit-message` | string | è‡ªåŠ¨ç”Ÿæˆ | è‡ªå®šä¹‰ commit message |
| `--pr` | bool | false | è‡ªåŠ¨åˆ›å»º GitHub PRï¼ˆéœ€è¦ GitHub Tokenï¼‰ |

**éªŒæ”¶æ ‡å‡†ï¼ˆpatchï¼‰ï¼š**

```
AC-PATCH-001: ç»™å®š --replace-with envï¼Œæ‰€æœ‰æ£€æµ‹åˆ°çš„ç¡¬ç¼–ç å¯†é’¥
              å¿…é¡»è¢«æ›¿æ¢ä¸ºå¯¹åº”è¯­è¨€çš„ç¯å¢ƒå˜é‡è¯»å–æ–¹å¼ï¼š
              - Python: os.environ["VAR_NAME"]
              - JavaScript: process.env.VAR_NAME
              - Go: os.Getenv("VAR_NAME")
              - Shell: $VAR_NAME

AC-PATCH-002: ç»™å®š --replace-with env --var-prefix APP_ï¼Œ
              ç”Ÿæˆçš„ç¯å¢ƒå˜é‡åå¿…é¡»ä»¥ APP_ å¼€å¤´ã€‚

AC-PATCH-003: ç»™å®š --commitï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ª git commitï¼Œ
              commit message ä¸­ä¸èƒ½åŒ…å«å¯†é’¥åŸæ–‡ã€‚

AC-PATCH-004: æ›¿æ¢åçš„ä»£ç å¿…é¡»è¯­æ³•æ­£ç¡®ï¼ˆé€šè¿‡å¯¹åº”è¯­è¨€çš„è¯­æ³•æ£€æŸ¥ï¼‰ã€‚
```

### 3.5 `history-clean` å‘½ä»¤è¯¦ç»†è§„æ ¼

```bash
secrethawk history-clean [é€‰é¡¹]
```

| å‚æ•°/Flag | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----------|------|--------|------|
| `--finding-id` | string | - | æŒ‡å®šè¦æ¸…ç†çš„ finding ID |
| `--all` | bool | false | æ¸…ç†æ‰€æœ‰å·²æ£€æµ‹åˆ°çš„ findings |
| `--method` | enum | `bfg` | æ¸…ç†æ–¹å¼ï¼š`bfg` / `filter-repo` / `rebase`ï¼ˆå°‘é‡ commitï¼‰ |
| `--backup` | bool | true | æ¸…ç†å‰åˆ›å»ºå¤‡ä»½åˆ†æ”¯ |

**éªŒæ”¶æ ‡å‡†ï¼ˆhistory-cleanï¼‰ï¼š**

```
AC-HIST-001: æ¸…ç†åï¼Œgit log --all -p ä¸­ä¸åº”å†åŒ…å«è¢«æ¸…ç†çš„å¯†é’¥åŸæ–‡ã€‚

AC-HIST-002: ç»™å®š --backup trueï¼Œæ¸…ç†å‰å¿…é¡»åˆ›å»º 
             backup/pre-secrethawk-clean-<timestamp> åˆ†æ”¯ã€‚

AC-HIST-003: æ¸…ç†åå¿…é¡»è¾“å‡ºè­¦å‘Šï¼š
             "å·²æ¸…ç†æœ¬åœ°å†å²ï¼Œä½ éœ€è¦ force push å¹¶é€šçŸ¥æ‰€æœ‰åä½œè€… rebase"ã€‚

AC-HIST-004: å¦‚æœç›®æ ‡ä»“åº“æœ‰æœªæäº¤çš„æ›´æ”¹ï¼Œå¿…é¡»æ‹’ç»æ‰§è¡Œå¹¶æç¤ºå…ˆ commit æˆ– stashã€‚
```

---

## 4. æ•°æ®æ¨¡å‹ä¸è¾“å‡ºæ ¼å¼

### 4.1 Finding Schemaï¼ˆJSONï¼‰

```jsonc
{
  "$schema": "https://secrethawk.dev/schemas/finding-v1.json",
  "findings": [
    {
      // å”¯ä¸€æ ‡è¯†
      "id": "f-20250115-001",
      
      // æ£€æµ‹ä¿¡æ¯
      "rule_id": "aws-access-key-id",
      "rule_name": "AWS Access Key ID",
      "severity": "critical",        // critical / high / medium / low
      "confidence": "high",          // high / medium / low
      "category": "cloud-credential", // åˆ†ç±»æ ‡ç­¾
      
      // ä½ç½®ä¿¡æ¯
      "location": {
        "file": "src/config.py",
        "line_start": 12,
        "line_end": 12,
        "column_start": 15,
        "column_end": 35,
        "commit": "a1b2c3d4",        // null è¡¨ç¤ºå·¥ä½œåŒº/staged
        "branch": "feature/deploy",
        "author_email": "dev@example.com",
        "committed_at": "2025-01-15T10:30:00Z"
      },
      
      // åŒ¹é…å†…å®¹ï¼ˆè„±æ•ï¼‰
      "match": {
        "raw_redacted": "AKIA3EXA...Q4F7",  // åªæ˜¾ç¤ºå‰åå‡ ä½
        "entropy": 4.2,
        "length": 20
      },
      
      // éªŒè¯ç»“æœï¼ˆ--validate æ—¶å¡«å……ï¼‰
      "validation": {
        "status": "active",          // active / inactive / unknown / error
        "validated_at": "2025-01-15T10:31:00Z",
        "method": "aws-sts-get-caller-identity",
        "details": {
          "iam_user": "deploy-bot",
          "permissions_summary": ["s3:*", "ec2:Describe*"]
        }
      },
      
      // ä¿®å¤çŠ¶æ€ï¼ˆremediate åæ›´æ–°ï¼‰
      "remediation": {
        "status": "pending",         // pending / in_progress / resolved / skipped / false_positive
        "actions_taken": [],
        "resolved_at": null,
        "resolved_by": null
      }
    }
  ],
  
  // æ‰«æå…ƒæ•°æ®
  "metadata": {
    "tool": "secrethawk",
    "version": "0.1.0",
    "scanned_at": "2025-01-15T10:30:00Z",
    "scan_target": ".",
    "scan_mode": "staged",           // staged / since / all-history / directory
    "files_scanned": 42,
    "duration_ms": 1230,
    "rules_loaded": 85,
    "policy_file": ".secrethawk/policy.yaml"
  }
}
```

### 4.2 SARIF è¾“å‡º

å¿…é¡»ç¬¦åˆ [SARIF 2.1.0 æ ‡å‡†](https://docs.oasis-open.org/sarif/sarif/v2.1.0/sarif-v2.1.0.html)ï¼Œç¡®ä¿å¯è¢« GitHub Code Scanning ç›´æ¥æ¶ˆè´¹ã€‚

**éªŒæ”¶æ ‡å‡†ï¼š**

```
AC-FORMAT-001: --format json è¾“å‡ºå¿…é¡»é€šè¿‡ Finding Schema çš„ JSON Schema æ ¡éªŒã€‚

AC-FORMAT-002: --format sarif è¾“å‡ºå¿…é¡»é€šè¿‡ SARIF 2.1.0 schema æ ¡éªŒï¼Œ
               ä¸”ä¸Šä¼ åˆ° GitHub Code Scanning åèƒ½æ­£ç¡®æ˜¾ç¤º findingsã€‚

AC-FORMAT-003: æ‰€æœ‰è¾“å‡ºæ ¼å¼ä¸­ï¼Œå¯†é’¥åŸæ–‡å¿…é¡»è„±æ•ï¼ˆåªæ˜¾ç¤ºå‰4å4ä½ï¼‰ã€‚

AC-FORMAT-004: --format human è¾“å‡ºå¿…é¡»æ”¯æŒç»ˆç«¯é¢œè‰²ï¼Œ
               ä¸”åœ¨æ— é¢œè‰²ç»ˆç«¯ï¼ˆå¦‚ CI æ—¥å¿—ï¼‰ä¸­è‡ªåŠ¨é™çº§ä¸ºçº¯æ–‡æœ¬ã€‚
```

---

## 5. è§„åˆ™æ–‡ä»¶æ ¼å¼

### 5.1 æ£€æµ‹è§„åˆ™ï¼ˆrules/*.yamlï¼‰

```yaml
# rules/aws.yaml
rules:
  - id: aws-access-key-id
    name: AWS Access Key ID
    severity: critical
    category: cloud-credential
    description: "Detects AWS Access Key IDs (starts with AKIA)"
    
    # æ£€æµ‹æ–¹å¼ï¼ˆè‡³å°‘ä¸€ç§ï¼‰
    detection:
      # æ­£åˆ™åŒ¹é…
      regex: '(?:^|[^A-Za-z0-9/+=])(AKIA[0-9A-Z]{16})(?:[^A-Za-z0-9/+=]|$)'
      
      # é¢å¤–è¿‡æ»¤æ¡ä»¶ï¼ˆå‡å°‘è¯¯æŠ¥ï¼‰
      must_match:
        - context_regex: '(?i)(aws|amazon|key|secret|access|credential)'
      must_not_match:
        - regex: 'AKIAIOSFODNN7EXAMPLE'   # AWS å®˜æ–¹ç¤ºä¾‹ key
        - regex: 'AKIA[0]{16}'            # å…¨é›¶æµ‹è¯• key
    
    # éªŒè¯æ–¹å¼ï¼ˆ--validate æ—¶ä½¿ç”¨ï¼‰
    validation:
      connector: aws
      method: sts-get-caller-identity
    
    # ä¿®å¤æŒ‡å¼•
    remediation:
      connector: aws
      actions:
        - type: rotate
          description: "Deactivate old key and create new one"
        - type: code-replace
          description: "Replace hardcoded key with environment variable"
          env_var_name: AWS_ACCESS_KEY_ID
      reference_url: "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#rotating_access_keys_console"
    
    # æµ‹è¯•ç”¨ä¾‹ï¼ˆpolicy test æ—¶ä½¿ç”¨ï¼‰
    tests:
      positive:
        - input: 'aws_key = "AKIA3EXAMPLE7JKXQ4F7"'
          should_match: true
        - input: 'export AWS_ACCESS_KEY_ID=AKIA2REALKEY9ABCDE12'
          should_match: true
      negative:
        - input: 'key = "AKIAIOSFODNN7EXAMPLE"'  # å®˜æ–¹ç¤ºä¾‹
          should_match: false
        - input: 'key = "not-a-real-key"'
          should_match: false
```

**éªŒæ”¶æ ‡å‡†ï¼š**

```
AC-RULE-001: å†…ç½®è§„åˆ™å¿…é¡»è¦†ç›–ä»¥ä¸‹ç±»å‹ï¼ˆMVP é˜¶æ®µï¼‰ï¼š
             - AWS Access Key ID + Secret Access Key
             - GitHub Personal Access Token (classic + fine-grained)
             - GitHub OAuth App credentials
             - Slack Bot Token / Webhook URL
             - Stripe API Key (live + test)
             - Generic Private Key (RSA / EC / PGP)
             - Generic High-Entropy String (>= 4.5 entropy, >= 20 chars)

AC-RULE-002: æ¯æ¡è§„åˆ™å¿…é¡»åŒ…å«è‡³å°‘ 2 ä¸ª positive å’Œ 2 ä¸ª negative æµ‹è¯•ç”¨ä¾‹ã€‚

AC-RULE-003: `secrethawk policy test` å¿…é¡»è¿è¡Œæ‰€æœ‰è§„åˆ™çš„æµ‹è¯•ç”¨ä¾‹ï¼Œ
             å¹¶æŠ¥å‘Šé€šè¿‡/å¤±è´¥æ•°é‡ã€‚

AC-RULE-004: ç”¨æˆ·å¯é€šè¿‡ --rules æŒ‡å®šè‡ªå®šä¹‰è§„åˆ™æ–‡ä»¶ï¼Œ
             è‡ªå®šä¹‰è§„åˆ™ä¸å†…ç½®è§„åˆ™åˆå¹¶ç”Ÿæ•ˆï¼ˆID å†²çªæ—¶è‡ªå®šä¹‰è¦†ç›–å†…ç½®ï¼‰ã€‚
```

---

## 5.2 ç­–ç•¥æ–‡ä»¶ï¼ˆ.secrethawk/policy.yamlï¼‰

```yaml
# .secrethawk/policy.yaml
version: "1"

# æ‰«æè¡Œä¸ºé…ç½®
scan:
  # å…¨å†å²æ‰«æ or å¢é‡
  default_mode: since-last-baseline
  
  # è·³è¿‡çš„æ–‡ä»¶/ç›®å½•
  exclude_paths:
    - "vendor/**"
    - "node_modules/**"
    - "**/*_test.go"
    - "docs/examples/**"
    - "*.lock"
  
  # è·³è¿‡çš„æ–‡ä»¶å¤§å°ï¼ˆKBï¼‰
  max_file_size_kb: 500

# Allowlistï¼ˆå·²çŸ¥å®‰å…¨ï¼Œä¸æŠ¥å‘Šï¼‰
allowlist:
  # æŒ‰å†…å®¹åŒ¹é…
  patterns:
    - regex: 'AKIAIOSFODNN7EXAMPLE'
      reason: "AWS official example key"
    - regex: 'sk_test_'
      reason: "Stripe test mode keys are safe"
  
  # æŒ‰è·¯å¾„åŒ¹é…
  paths:
    - pattern: "**/*.md"
      rules: ["generic-high-entropy"]  # åªå¿½ç•¥è¿™äº›è§„åˆ™
      reason: "Markdown files often contain example strings"
  
  # æŒ‰ commit åŒ¹é…
  commits:
    - sha: "a1b2c3d4e5f6"
      reason: "Historical commit, already remediated"

# ä¸¥é‡çº§åˆ«ç­–ç•¥
severity:
  # CI ä¸­é˜»æ–­æäº¤çš„æœ€ä½çº§åˆ«
  block_on: high
  
  # ä¿®å¤ SLAï¼ˆå›¢é˜Ÿç‰ˆåŠŸèƒ½ï¼‰
  sla:
    critical:
      max_hours: 1
      escalate_to: "#security-alerts"
    high:
      max_hours: 24
      escalate_to: "#dev-team"
    medium:
      max_hours: 168  # 7 days
    low:
      max_hours: null  # ä¸å¼ºåˆ¶

# é€šçŸ¥é…ç½®ï¼ˆå›¢é˜Ÿç‰ˆåŠŸèƒ½ï¼‰
notifications:
  slack:
    webhook_url: "${SECRETHAWK_SLACK_WEBHOOK}"
    channel: "#security-alerts"
    on: [critical, high]
  
  github_issue:
    enabled: true
    assignee_from: git_blame
    labels: ["security", "secret-leak"]
    on: [critical]
```

---

## 6. è¿æ¥å™¨æ¥å£ï¼ˆConnector Interfaceï¼‰

### 6.1 æ¥å£å®šä¹‰

```go
// connector.go

// Connector å®šä¹‰äº†ä¸€ä¸ªå¯†é’¥æœåŠ¡çš„è¿æ¥å™¨æ¥å£
type Connector interface {
    // å…ƒæ•°æ®
    Name() string                    // å¦‚ "aws", "github", "stripe"
    DisplayName() string             // å¦‚ "Amazon Web Services"
    SupportedRuleIDs() []string      // è¯¥è¿æ¥å™¨æ”¯æŒçš„è§„åˆ™ ID åˆ—è¡¨

    // éªŒè¯ï¼šè¿™ä¸ªå¯†é’¥æ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼Ÿ
    Validate(ctx context.Context, secret string) (*ValidationResult, error)

    // æ’¤é”€ï¼šä½¿è¿™ä¸ªå¯†é’¥å¤±æ•ˆ
    Revoke(ctx context.Context, secret string) (*ActionResult, error)

    // è½®è½¬ï¼šæ’¤é”€æ—§å¯†é’¥ + ç”Ÿæˆæ–°å¯†é’¥
    Rotate(ctx context.Context, secret string) (*RotationResult, error)

    // å‰ç½®æ¡ä»¶æ£€æŸ¥ï¼šæ‰§è¡Œæ“ä½œå‰éœ€è¦ä»€ä¹ˆæƒé™/é…ç½®ï¼Ÿ
    PreflightCheck(ctx context.Context) (*PreflightResult, error)
}

// ValidationResult éªŒè¯ç»“æœ
type ValidationResult struct {
    IsActive    bool              // å¯†é’¥æ˜¯å¦ä»ç„¶æœ‰æ•ˆ
    Method      string            // éªŒè¯æ–¹æ³•æè¿°
    Details     map[string]string // é¢å¤–ä¿¡æ¯ï¼ˆå¦‚ IAM userã€æƒé™ç­‰ï¼‰
    ValidatedAt time.Time
}

// ActionResult æ“ä½œç»“æœ
type ActionResult struct {
    Success     bool
    Message     string
    ExecutedAt  time.Time
}

// RotationResult è½®è½¬ç»“æœ
type RotationResult struct {
    OldKeyRevoked bool
    NewKeyID      string            // æ–°å¯†é’¥ IDï¼ˆéå®Œæ•´å¯†é’¥ï¼‰
    StoredAt      string            // æ–°å¯†é’¥å­˜å‚¨ä½ç½®æè¿°
    ExecutedAt    time.Time
}

// PreflightResult å‰ç½®æ£€æŸ¥ç»“æœ
type PreflightResult struct {
    Ready    bool
    Missing  []PreflightItem       // ç¼ºå°‘ä»€ä¹ˆ
}

type PreflightItem struct {
    Name        string  // å¦‚ "AWS_ACCESS_KEY_ID environment variable"
    Description string  // å¦‚ "Needed to call IAM API for key rotation"
    HowToFix    string  // å¦‚ "export AWS_ACCESS_KEY_ID=..."
}
```

### 6.2 MVP è¿æ¥å™¨æ¸…å•

| è¿æ¥å™¨ | Validate | Revoke | Rotate | ä¼˜å…ˆçº§ |
|--------|----------|--------|--------|--------|
| AWS IAM | âœ… STS GetCallerIdentity | âœ… UpdateAccessKey(Inactive) | âœ… CreateAccessKey + Delete | P0 |
| GitHub Token | âœ… GET /user | âœ… DELETE /installation/token æˆ–æç¤ºæ‰‹åŠ¨ | âš ï¸ å¼•å¯¼åˆ° Settings é¡µé¢ | P0 |
| Slack Bot Token | âœ… auth.test | âš ï¸ æç¤ºåˆ° Slack App é¡µé¢ | âš ï¸ æç¤º regenerate | P1 |
| Stripe API Key | âœ… GET /v1/charges?limit=1 | âš ï¸ å¼•å¯¼åˆ° Dashboard | âš ï¸ å¼•å¯¼åˆ° Dashboard | P1 |
| Generic / æœªçŸ¥ | âŒ | âŒ | âŒ | - |

> âš ï¸ = ä¸èƒ½å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæä¾›æ“ä½œé“¾æ¥å’Œæ­¥éª¤æŒ‡å¼•

**éªŒæ”¶æ ‡å‡†ï¼ˆConnectorï¼‰ï¼š**

```
AC-CONN-001: AWS è¿æ¥å™¨ Validateï¼šç»™å®šæœ‰æ•ˆ AWS Keyï¼Œè¿”å› IsActive=true 
             ä¸” Details ä¸­åŒ…å« IAM User ARNã€‚

AC-CONN-002: AWS è¿æ¥å™¨ Validateï¼šç»™å®šå·²æ’¤é”€ AWS Keyï¼Œè¿”å› IsActive=falseã€‚

AC-CONN-003: AWS è¿æ¥å™¨ Rotateï¼šæ‰§è¡Œåæ—§å¯†é’¥å¿…é¡»æ— æ³•é€šè¿‡ STS éªŒè¯ï¼Œ
             æ–°å¯†é’¥å¿…é¡»å¯é€šè¿‡ STS éªŒè¯ã€‚

AC-CONN-004: AWS è¿æ¥å™¨ PreflightCheckï¼šå½“ AWS å‡­æ®æœªé…ç½®æ—¶ï¼Œ
             è¿”å› Ready=false ä¸” Missing ä¸­åŒ…å«å…·ä½“é…ç½®æŒ‡å¼•ã€‚

AC-CONN-005: GitHub è¿æ¥å™¨ Validateï¼šç»™å®šæœ‰æ•ˆ PATï¼Œè¿”å› IsActive=true
             ä¸” Details ä¸­åŒ…å«ç”¨æˆ·åå’Œ scope åˆ—è¡¨ã€‚

AC-CONN-006: å½“ä½¿ç”¨ä¸æ”¯æŒè‡ªåŠ¨æ’¤é”€çš„è¿æ¥å™¨æ—¶ï¼ŒRevoke å¿…é¡»è¿”å›
             åŒ…å«æ‰‹åŠ¨æ“ä½œ URL å’Œæ­¥éª¤çš„ ActionResultï¼Œè€Œä¸æ˜¯æŠ¥é”™ã€‚

AC-CONN-007: æ‰€æœ‰è¿æ¥å™¨çš„ API è°ƒç”¨å¿…é¡»æœ‰ timeoutï¼ˆé»˜è®¤ 10 ç§’ï¼‰
             å’Œ retryï¼ˆæœ€å¤š 3 æ¬¡ï¼ŒæŒ‡æ•°é€€é¿ï¼‰ã€‚

AC-CONN-008: æ‰€æœ‰è¿æ¥å™¨çš„ API è°ƒç”¨å‡­æ®å¿…é¡»ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œ
             ä¸å¾—ç¡¬ç¼–ç æˆ–ä»é…ç½®æ–‡ä»¶æ˜æ–‡è¯»å–ã€‚
```

---

## 7. CI/CD é›†æˆè§„æ ¼

### 7.1 GitHub Action

```yaml
# .github/workflows/secret-scan.yml
name: SecretHawk Scan
on:
  pull_request:
  push:
    branches: [main]

jobs:
  secret-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # éœ€è¦ git å†å²

      - name: SecretHawk Scan
        uses: secrethawk/action@v1
        with:
          # æ‰«ææ¨¡å¼
          scan-mode: since        # staged / since / all-history
          since-ref: origin/main
          
          # è¡Œä¸º
          fail-on: high           # å‘ç° high+ æ—¶ PR å¤±è´¥
          format: sarif           # è¾“å‡º SARIF
          validate: true          # éªŒè¯å¯†é’¥æ˜¯å¦æœ‰æ•ˆ
          
          # ä¸Šä¼ åˆ° GitHub Code Scanning
          upload-sarif: true

      # å¯é€‰ï¼šæ‰«æç»“æœä½œä¸º PR comment
      - name: Comment on PR
        if: failure()
        uses: secrethawk/action/comment@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
```

**éªŒæ”¶æ ‡å‡†ï¼ˆGitHub Actionï¼‰ï¼š**

```
AC-CI-001: Action åœ¨ PR ä¸­å‘ç° critical secret æ—¶ï¼Œ
           PR check å¿…é¡»æ˜¾ç¤ºä¸º failedï¼Œä¸” PR é¡µé¢æ˜¾ç¤º annotationã€‚

AC-CI-002: SARIF ä¸Šä¼ åï¼ŒGitHub Security tab ä¸­å¿…é¡»å‡ºç°å¯¹åº” alertã€‚

AC-CI-003: Action æ‰§è¡Œæ—¶é—´ä¸è¶…è¿‡ 2 åˆ†é’Ÿï¼ˆå¯¹äº 1000 æ–‡ä»¶ä»¥å†…çš„ä»“åº“ï¼‰ã€‚

AC-CI-004: Action ä¸éœ€è¦ä»»ä½• secret é…ç½®å³å¯å®ŒæˆåŸºç¡€æ‰«æ
          ï¼ˆvalidate åŠŸèƒ½éœ€è¦å¯¹åº”çš„ secretï¼‰ã€‚
```

### 7.2 Pre-commit Hook

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/secrethawk/secrethawk
    rev: v0.1.0
    hooks:
      - id: secrethawk
        args: ['scan', '--staged', '--fail-on', 'medium']
```

**éªŒæ”¶æ ‡å‡†ï¼š**

```
AC-HOOK-001: pre-commit hook åœ¨ staged æ–‡ä»¶åŒ…å« high+ secret æ—¶
             é˜»æ­¢ commit å¹¶è¾“å‡º finding è¯¦æƒ…ã€‚

AC-HOOK-002: pre-commit hook æ‰§è¡Œæ—¶é—´ä¸è¶…è¿‡ 3 ç§’ï¼ˆ100 ä¸ª staged æ–‡ä»¶ä»¥å†…ï¼‰ã€‚

AC-HOOK-003: å¼€å‘è€…å¯é€šè¿‡ `git commit --no-verify` è·³è¿‡
            ï¼ˆå·¥å…·ä¸åº”é˜»æ­¢è¿™ä¸ª git åŸç”Ÿè¡Œä¸ºï¼‰ã€‚
```

---

## 8. äº‹æ•…æŠ¥å‘Šæ¨¡æ¿

`secrethawk report` ç”Ÿæˆçš„ Markdown æ–‡ä»¶ï¼š

```markdown
# ğŸ” Secret Leak Incident Report

**Report ID:** INC-2025-0115-001  
**Generated by:** SecretHawk v0.1.0  
**Generated at:** 2025-01-15T10:35:00Z  

## Summary

| Field | Value |
|-------|-------|
| Secret Type | AWS Access Key ID |
| Severity | ğŸ”´ CRITICAL |
| File | `src/config.py:12` |
| Commit | `a1b2c3d4` |
| Author | dev@example.com |
| First Exposed | 2025-01-14T09:00:00Z |
| Detected | 2025-01-15T10:30:00Z |
| Remediated | 2025-01-15T10:35:00Z |
| **Time to Remediate** | **5 minutes** |

## Actions Taken

- [x] Key validated as ACTIVE
- [x] Old key deactivated via AWS IAM API
- [x] New key created and stored in AWS Secrets Manager
- [x] Code updated: hardcoded value â†’ `os.environ["AWS_ACCESS_KEY_ID"]`
- [ ] Git history cleaned (pending: requires force push)
- [x] This incident report generated

## Impact Assessment

- **Scope:** Key had permissions: `s3:*`, `ec2:Describe*`
- **Exposure Duration:** ~25 hours
- **Public Exposure:** Yes (public GitHub repository)

## Recommendations

1. Review CloudTrail logs for unauthorized usage during exposure window
2. Rotate all credentials that may have been accessed using this key
3. Enable GitHub Push Protection to prevent future leaks
```

---

## 9. Baseline æ–‡ä»¶æ ¼å¼

```jsonc
// .secrethawk/baseline.json
{
  "version": "1",
  "generated_at": "2025-01-15T10:00:00Z",
  "generated_by": "secrethawk v0.1.0",
  "entries": [
    {
      "finding_id": "f-20250115-001",
      "rule_id": "aws-access-key-id",
      "file": "src/config.py",
      "line_hash": "sha256:abcdef...",  // è¡Œå†…å®¹ hashï¼ˆæ–‡ä»¶å˜åŠ¨æ—¶å¯æ£€æµ‹ï¼‰
      "status": "resolved",             // resolved / skipped / false_positive
      "reason": "Key rotated and code patched",
      "added_at": "2025-01-15T10:35:00Z",
      "added_by": "dev@example.com"
    }
  ]
}
```

---

## 10. é‡Œç¨‹ç¢‘ä¸äº¤ä»˜è®¡åˆ’

### Phase 1: MVPï¼ˆç¬¬ 1â€“4 å‘¨ï¼‰

| å‘¨ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|----|--------|----------|
| W1 | Scanner Engine + å†…ç½®è§„åˆ™ï¼ˆ7 ç±»å‹ï¼‰ | AC-SCAN-001 ~ 011, AC-RULE-001 ~ 004 |
| W2 | Remediate äº¤äº’å¼å‘å¯¼ï¼ˆæ— è¿æ¥å™¨ï¼Œçº¯æŒ‡å¼•ï¼‰ | AC-REM-003, 006, 007, 008 |
| W3 | JSON/SARIF è¾“å‡º + pre-commit hook | AC-FORMAT-001 ~ 004, AC-HOOK-001 ~ 003 |
| W4 | brew/goreleaser åˆ†å‘ + README + demo repo | å¯é€šè¿‡ `brew install secrethawk` å®‰è£…å¹¶è¿è¡Œå®Œæ•´ scan â†’ remediate æµç¨‹ |

### Phase 2: Connectorsï¼ˆç¬¬ 5â€“8 å‘¨ï¼‰

| å‘¨ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|----|--------|----------|
| W5-6 | AWS è¿æ¥å™¨ï¼ˆvalidate + rotateï¼‰ | AC-CONN-001 ~ 004 |
| W7 | GitHub è¿æ¥å™¨ï¼ˆvalidate + revoke æŒ‡å¼•ï¼‰ | AC-CONN-005 ~ 006 |
| W8 | GitHub Action ä¸Šæ¶ + ç¬¬ä¸€ç¯‡æ¨å¹¿æ–‡ç«  | AC-CI-001 ~ 004 |

### Phase 3: Team Editionï¼ˆç¬¬ 9â€“12 å‘¨ï¼‰

| å‘¨ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|----|--------|----------|
| W9-10 | Incident Report ç”Ÿæˆ + Baseline ç®¡ç† | AC-REM-006, baseline ç›¸å…³ |
| W11 | Slack é€šçŸ¥ + Policy SLA é…ç½® | ç­–ç•¥æ–‡ä»¶ä¸­ SLA é…ç½®ç”Ÿæ•ˆ |
| W12 | æ‰¾ 20 ä¸ª design partner + æ”¶é›†åé¦ˆ | è‡³å°‘ 5 ä¸ªå›¢é˜Ÿå®Œæˆå®Œæ•´æµç¨‹å¹¶ç»™å‡ºåé¦ˆ |

---

## 11. æˆåŠŸæŒ‡æ ‡ï¼ˆKPIï¼‰

| é˜¶æ®µ | æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|------|
| MVP å‘å¸ƒå 30 å¤© | GitHub Stars | â‰¥ 200 |
| MVP å‘å¸ƒå 30 å¤© | brew install æ¬¡æ•° | â‰¥ 500 |
| MVP å‘å¸ƒå 60 å¤© | GitHub Action å®‰è£…æ•° | â‰¥ 50 ä¸ªä»“åº“ |
| Phase 2 å®Œæˆå | æ´»è·ƒç”¨æˆ·ï¼ˆæœˆæ‰§è¡Œ â‰¥ 1 æ¬¡ scanï¼‰ | â‰¥ 100 |
| Phase 3 å®Œæˆå | Design Partnerï¼ˆä»˜è´¹æˆ–æ·±åº¦åé¦ˆï¼‰ | â‰¥ 5 ä¸ªå›¢é˜Ÿ |
| 6 ä¸ªæœˆ | MRRï¼ˆæœˆç»å¸¸æ€§æ”¶å…¥ï¼‰ | â‰¥ $2,000 |

---

