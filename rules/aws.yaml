rules:
  - id: aws-access-key-id
    name: AWS Access Key ID
    severity: critical
    category: cloud-credential
    description: Detects AWS Access Key IDs (AKIA prefix)
    detection:
      regex: '(?:^|[^A-Za-z0-9/+=])(AKIA[0-9A-Z]{16})(?:[^A-Za-z0-9/+=]|$)'
      must_not_match:
        - regex: 'AKIAIOSFODNN7EXAMPLE'
    validation:
      connector: aws
      method: sts-get-caller-identity
    remediation:
      connector: aws
      actions:
        - type: rotate
          description: Deactivate old key and create new one
        - type: code-replace
          description: Replace hardcoded key with environment variable
          env_var_name: AWS_ACCESS_KEY_ID
    tests:
      positive:
        - input: 'aws_key = "AKIA3EXAMPLE7JKXQ4F7"'
          should_match: true
        - input: 'export AWS_ACCESS_KEY_ID=AKIA2REALKEY9ABCDE12'
          should_match: true
      negative:
        - input: 'key = "AKIAIOSFODNN7EXAMPLE"'
          should_match: false
        - input: 'key = "not-a-real-key"'
          should_match: false
